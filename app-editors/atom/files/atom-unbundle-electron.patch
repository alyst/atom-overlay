From 61cf2736d84601fabc7490105f107978258c7294 Mon Sep 17 00:00:00 2001
From: Elvis Pranskevichus <elvis@magic.io>
Date: Thu, 11 Feb 2016 22:07:19 -0500
Subject: [PATCH 1/2] Unbundle electron

---
 atom.sh                       | 11 ++++-------
 build/Gruntfile.coffee        |  2 +-
 build/package.json            |  2 +-
 build/tasks/build-task.coffee |  2 +-
 4 files changed, 7 insertions(+), 10 deletions(-)

diff --git a/atom.sh b/atom.sh
index ef8dbcd..2a0c544 100755
--- a/atom.sh
+++ b/atom.sh
@@ -89,11 +89,8 @@ elif [ $OS == 'Linux' ]; then
   SCRIPT=$(readlink -f "$0")
   USR_DIRECTORY=$(readlink -f $(dirname $SCRIPT)/..)
 
-  if [ -n "$BETA_VERSION" ]; then
-    ATOM_PATH="$USR_DIRECTORY/share/atom-beta/atom"
-  else
-    ATOM_PATH="$USR_DIRECTORY/share/atom/atom"
-  fi
+  ATOM_APP_PATH="{{ATOM_APP_PATH}}"
+  ATOM_PATH="{{ATOM_PATH}}"
 
   ATOM_HOME="${ATOM_HOME:-$HOME/.atom}"
   mkdir -p "$ATOM_HOME"
@@ -103,11 +100,11 @@ elif [ $OS == 'Linux' ]; then
   [ -x "$ATOM_PATH" ] || ATOM_PATH="$TMPDIR/atom-build/Atom/atom"
 
   if [ $EXPECT_OUTPUT ]; then
-    "$ATOM_PATH" --executed-from="$(pwd)" --pid=$$ "$@"
+    "$ATOM_PATH" --app="$ATOM_APP_PATH" --executed-from="$(pwd)" --pid=$$ "$@"
     exit $?
   else
     (
-    nohup "$ATOM_PATH" --executed-from="$(pwd)" --pid=$$ "$@" > "$ATOM_HOME/nohup.out" 2>&1
+    nohup "$ATOM_PATH" --app="$ATOM_APP_PATH" --executed-from="$(pwd)" --pid=$$ "$@" > "$ATOM_HOME/nohup.out" 2>&1
     if [ $? -ne 0 ]; then
       cat "$ATOM_HOME/nohup.out"
       exit $?
diff --git a/build/Gruntfile.coffee b/build/Gruntfile.coffee
index 60d5916..3b8888e 100644
--- a/build/Gruntfile.coffee
+++ b/build/Gruntfile.coffee
@@ -297,7 +297,7 @@ module.exports = (grunt) ->
   ciTasks.push('publish-build') unless process.env.CI
   grunt.registerTask('ci', ciTasks)
 
-  defaultTasks = ['download-electron', 'download-electron-chromedriver', 'build', 'set-version', 'generate-asar']
+  defaultTasks = ['build', 'set-version', 'generate-asar']
   unless process.platform is 'linux' or grunt.option('no-install')
     defaultTasks.push 'install'
   grunt.registerTask('default', defaultTasks)
diff --git a/build/package.json b/build/package.json
index d5c780c..b8087eb 100644
--- a/build/package.json
+++ b/build/package.json
@@ -30,7 +30,7 @@
     "grunt-standard": "^1.0.2",
     "legal-eagle": "~0.13.0",
     "minidump": "~0.9",
-    "npm": "2.13.3",
+    "npm": "^2.13.3",
     "rcedit": "~0.3.0",
     "request": "~2.27.0",
     "rimraf": "~2.2.2",
diff --git a/build/tasks/build-task.coffee b/build/tasks/build-task.coffee
index a86c7c1..b021ff6 100644
--- a/build/tasks/build-task.coffee
+++ b/build/tasks/build-task.coffee
@@ -19,7 +19,7 @@ module.exports = (grunt) ->
       fs.renameSync path.join(shellAppDir, 'Contents', 'MacOS', 'Electron'), path.join(shellAppDir, 'Contents', 'MacOS', 'Atom')
       fs.renameSync path.join(shellAppDir, 'Contents', 'Frameworks', 'Electron Helper.app'), path.join(shellAppDir, 'Contents', 'Frameworks', 'Atom Helper.app')
       fs.renameSync path.join(shellAppDir, 'Contents', 'Frameworks', 'Atom Helper.app', 'Contents', 'MacOS', 'Electron Helper'), path.join(shellAppDir, 'Contents', 'Frameworks', 'Atom Helper.app', 'Contents', 'MacOS', 'Atom Helper')
-    else
+    else if false
       cp 'electron', shellAppDir, filter: /default_app/
 
       if process.platform is 'win32'
-- 
2.4.10

